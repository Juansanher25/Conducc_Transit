<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conducción Transitoria en Sistemas Concentrados</title>
    <!-- Carga de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilos personalizados para el fondo y la fuente */
        :root {
            --color-primary: #0369a1; /* Sky-700 */
            --color-secondary: #fcd34d; /* Amber-300 */
            --color-accent: #dc2626; /* Red-600 */
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        /* Estilo para el acordeón activo */
        .accordion-item.active {
            background-color: var(--color-secondary);
            color: #1f2937; /* Gris oscuro para contraste */
        }
        .accordion-item:hover {
             background-color: #fde68a; /* Amber-200 */
        }
        /* Estilo para el botón de respuesta correcto */
        .correct-answer {
            background-color: #10b981; /* Esmeralda-500 */
            color: white;
            border-color: #059669;
        }
        /* Estilo para el botón de respuesta incorrecto */
        .incorrect-answer {
            background-color: #ef4444; /* Rojo-500 */
            color: white;
            border-color: #b91c1c;
        }
        /* Estilo para los bloques de ecuaciones MathJax */
        .math-block {
            padding: 1rem;
            margin: 1rem 0;
            background-color: #e0f2fe; /* Light blue */
            border-radius: 0.5rem;
            text-align: center;
            font-size: 1.1rem; /* Ligeramente más pequeño para móvil */
            color: #0369a1;
            overflow-x: auto;
        }
    </style>
    <!-- Carga de MathJax 2.7.7 con configuración específica para delimitar $ y $$ y evitar el renderizado inicial automático -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            skipStartupTypeset: true,
            tex2jax: {
                inlineMath: [['$','$'], ['\\(','\\)']],
                displayMath: [['$$','$$'], ['\\[','\\]']],
                processEscapes: true,
                skipTags: ["script", "noscript", "style", "textarea", "pre", "code", "a"]
            },
            "HTML-CSS": {
                styles: {".MathJax_Display": {"text-align": "center"}}
            }
        });
    </script>
</head>
<body class="bg-gray-100">

    <div class="relative min-h-screen md:flex">
        <!-- Overlay para el menú móvil -->
        <div id="mobile-menu-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden md:hidden"></div>

        <!-- Sidebar de Navegación -->
        <nav id="sidebar" class="bg-sky-700 text-white w-64 space-y-6 py-7 px-2 absolute inset-y-0 left-0 transform -translate-x-full md:relative md:translate-x-0 transition duration-300 ease-in-out z-30">
            <div class="px-4 border-b border-sky-600 pb-4 flex justify-between items-center">
                <div>
                    <h1 class="text-2xl font-extrabold text-amber-300">Módulo TC-I</h1>
                    <p class="text-sm">Sistemas Concentrados</p>
                </div>
                <!-- Botón de cerrar para móvil -->
                <button id="close-menu-btn" class="md:hidden p-1 rounded-md hover:bg-sky-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div id="accordion-nav" class="p-2 space-y-1">
                <!-- Los ítems del acordeón se renderizarán aquí por JS -->
            </div>
        </nav>

        <!-- Contenido Principal -->
        <div class="flex-1 flex flex-col">
            <!-- Header para móvil -->
            <header class="md:hidden bg-sky-700 text-white p-4 shadow-lg flex justify-between items-center">
                <button id="mobile-menu-btn" class="p-1 rounded-md hover:bg-sky-600">
                     <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                </button>
                <h2 class="text-lg font-bold text-amber-300">Sistemas Concentrados</h2>
            </header>

            <main id="content-area" class="flex-grow p-4 sm:p-6 md:p-8 overflow-y-auto">
                <article id="module-content" class="bg-white p-6 md:p-10 rounded-xl shadow-2xl max-w-4xl mx-auto">
                    <!-- El contenido de la sección activa se renderizará aquí -->
                </article>
            </main>
        </div>
    </div>

    <script>
        const csvData = `t (s),T(t) b=0.31 (°C),T(t) b=0.46 (°C),T(t) b=1.34 (°C)
0,100,100,100
1,75.65,63.27,26.24
2,57.88,39.99,11.70
3,44.92,25.27,10.23
4,35.47,15.96,10.03
5,28.57,10.08,10.00
6,23.55,6.37,10.00
7,19.88,4.02,10.00
8,17.21,2.54,10.00
9,15.26,1.61,10.00
10,13.83,1.01,10.00
15,10.79,0.10,10.00
20,10.16,0.02,10.00
25,10.03,0.00,10.00
`;

        const moduleContent = [
            { id: 'portada', title: '1. Portada', content: `
                <div class="text-center py-10 sm:py-20 bg-sky-50 rounded-lg shadow-inner">
                    <h1 class="text-2xl sm:text-4xl font-black text-sky-800 mb-4">CONDUCCIÓN TRANSITORIA DE CALOR EN SISTEMAS CONCENTRADOS</h1>
                    <p class="text-lg sm:text-xl text-gray-700 font-semibold mb-8">Análisis y Aplicaciones Fundamentales</p>
                    <div class="border-t-4 border-amber-400 w-24 mx-auto mb-8"></div>
                    <p class="text-xl sm:text-2xl font-bold text-gray-800">Juan Sandoval Herrera (Ph.D.)</p>
                    <p class="text-base sm:text-lg text-gray-600">Transferencia de calor I. 2025.</p>
                </div>
            `},
            { id: 'introduccion', title: '2. Introducción', content: `
                <h2 class="text-2xl sm:text-3xl font-extrabold text-sky-800 mb-6 border-b-2 border-amber-400 pb-2">Introducción al Análisis Transitorio</h2>
                <p class="text-gray-700 leading-relaxed mb-4">El <strong class="text-sky-600">Análisis de la Conducción Transitoria de Calor</strong> estudia cómo la temperatura de un cuerpo varía con el tiempo y la posición, $T(x, y, z, t)$.</p>
                <p class="text-gray-700 leading-relaxed mb-4">El <strong class="text-sky-600">Análisis de Sistemas Concentrados</strong> es una simplificación poderosa que asume que la <strong class="text-amber-600">temperatura dentro del cuerpo es uniforme</strong> y solo cambia con el tiempo, $T(t)$, sin variar con la posición.</p>
                <p class="text-red-600 font-semibold leading-relaxed">Esta idealización es válida cuando la resistencia interna del cuerpo a la conducción de calor es muy pequeña en comparación con la resistencia externa a la convección.</p>
            `},
            { id: 'teoria', title: '3. Teoría y Ecuaciones', content: `
                <h2 class="text-2xl sm:text-3xl font-extrabold text-sky-800 mb-6 border-b-2 border-amber-400 pb-2">Desarrollo de Ecuaciones</h2>
                <h3 class="text-xl sm:text-2xl font-semibold text-gray-700 mb-3">Balance de Energía</h3>
                <p class="text-gray-700 mb-4">El modelo se deriva del balance de energía. Para un cuerpo que se enfría ($T > T_{\\infty}$):</p>
                <div class="math-block">
                    $$\\text{Tasa de calor que sale} = \\text{Tasa de disminución de energía interna}$$
                    $$h A_s (T - T_{\\infty}) = - \\rho V C_p \\frac{dT}{dt}$$
                </div>
                <p class="text-gray-700 mb-4">Donde $h$ es el coeficiente de convección, $A_s$ el área superficial, $T_{\\infty}$ la temperatura del ambiente, $\\rho$ la densidad, $V$ el volumen y $C_p$ el calor específico.</p>
                <h3 class="text-xl sm:text-2xl font-semibold text-gray-700 mb-3">Ecuación de Temperatura vs. Tiempo</h3>
                <p class="text-gray-700 mb-4">Al integrar la ecuación diferencial con la condición inicial $T(0) = T_i$, se obtiene el decaimiento exponencial:</p>
                <div class="math-block">
                    $$\\frac{T(t) - T_{\\infty}}{T_i - T_{\\infty}} = e^{-b t}$$
                </div>
                <p class="text-gray-700 mb-4">Donde $b$ es la <strong class="text-sky-600">constante de tiempo</strong> ($\text{s}^{-1}$):</p>
                <div class="math-block">
                    $$b = \\frac{h A_s}{\\rho V C_p}$$
                </div>
            `},
            { id: 'criterio', title: '4. Criterio de Idealización (Bi)', content: `
                <h2 class="text-2xl sm:text-3xl font-extrabold text-sky-800 mb-6 border-b-2 border-amber-400 pb-2">Criterio: Número de Biot (Bi)</h2>
                <p class="text-gray-700 mb-4">La validez del modelo se cuantifica mediante el **Número de Biot (Bi)**:</p>
                <div class="math-block">
                    $$\\text{Bi} = \\frac{\\text{Res. Conducción Interna}}{\\text{Res. Convección Externa}} = \\frac{h L_c}{k}$$
                </div>
                <p class="text-gray-700 mb-4">Donde la <strong class="text-sky-600">Longitud Característica</strong> es $L_c = V/A_s$.</p>
                <h3 class="text-xl sm:text-2xl font-semibold text-red-600 mb-3">Condición de Validez</h3>
                <div class="bg-red-50 p-4 rounded-lg border-l-4 border-red-600 mb-6">
                    <p class="font-bold text-red-700 text-lg">El análisis es válido si:</p>
                    <div class="math-block text-red-700">
                        $$\\text{Bi} \\le 0.1$$
                    </div>
                    <p class="text-sm text-red-600">$R_{\\text{cond}} \\ll R_{\\text{conv}}$.</p>
                </div>
            `},
            { id: 'graficos', title: '5. Gráficas y Simulación', content: `
                <h2 class="text-2xl sm:text-3xl font-extrabold text-sky-800 mb-6 border-b-2 border-amber-400 pb-2">Comportamiento Gráfico</h2>
                <h3 class="text-xl sm:text-2xl font-semibold text-gray-700 mb-3">Gráfica de Temperatura vs. Tiempo</h3>
                <p class="text-gray-700 mb-4">La siguiente gráfica, generada a partir de tus datos, muestra cómo se enfrían tres materiales. Un valor más alto de la <strong class="text-red-600">constante de tiempo (b)</strong> resulta en un enfriamiento más rápido.</p>
                <div class="bg-sky-50 p-2 sm:p-4 rounded-lg shadow-inner">
                    <svg viewBox="0 0 800 450" xmlns="http://www.w3.org/2000/svg" style="font-family: 'Inter', sans-serif;">
                        <text x="400" y="30" text-anchor="middle" font-size="20" font-weight="bold" fill="#0c4a6e">Influencia de la Constante de Tiempo (b)</text>
                        <line x1="60" y1="400" x2="750" y2="400" stroke="#374151" stroke-width="2" />
                        <line x1="60" y1="400" x2="60" y2="50" stroke="#374151" stroke-width="2" />
                        <text x="755" y="405" font-size="14" font-weight="bold" fill="#374151">Tiempo (s)</text>
                        <text x="50" y="45" text-anchor="end" font-size="14" font-weight="bold" fill="#374151" transform="rotate(-90, 50, 50)">T (°C)</text>
                        <line x1="60" y1="380" x2="750" y2="380" stroke="#0369a1" stroke-width="2" stroke-dasharray="5,5" />
                        <text x="70" y="375" font-size="12" fill="#0369a1">T∞ (Ambiente)</text>
                        <text x="70" y="100" font-size="12" fill="#374151">Ti (Inicial)</text>
                        <path d="M 60 110 C 150 115, 300 280, 750 375" stroke="#0ea5e9" stroke-width="3" fill="none" />
                        <path d="M 60 110 C 120 140, 250 320, 750 378" stroke="#f97316" stroke-width="3" fill="none" />
                        <path d="M 60 110 C 90 250, 180 360, 750 379" stroke="#dc2626" stroke-width="3" fill="none" />
                        <g transform="translate(500, 70)">
                             <rect x="0" y="0" width="250" height="110" fill="rgba(255,255,255,0.9)" stroke="#d1d5db" rx="5" />
                            <g transform="translate(15, 30)"><line x1="0" y1="0" x2="30" y2="0" stroke="#0ea5e9" stroke-width="3" /><text x="40" y="5" font-size="14">Material 1 (b = 0.31 s⁻¹)</text></g>
                            <g transform="translate(15, 60)"><line x1="0" y1="0" x2="30" y2="0" stroke="#f97316" stroke-width="3" /><text x="40" y="5" font-size="14">Material 2 (b = 0.46 s⁻¹)</text></g>
                            <g transform="translate(15, 90)"><line x1="0" y1="0" x2="30" y2="0" stroke="#dc2626" stroke-width="3" /><text x="40" y="5" font-size="14">Material 3 (b = 1.34 s⁻¹)</text></g>
                        </g>
                    </svg>
                </div>
                <h3 class="text-xl sm:text-2xl font-semibold text-gray-700 mt-8 mb-3">Simulación Interactiva</h3>
                <p class="text-gray-700 mb-4">Puedes descargar los datos de la simulación en formato CSV para usarlos en tu propia hoja de cálculo.</p>
                <div class="mt-4">
                    <a href="data:text/csv;charset=utf-8,${encodeURIComponent(csvData)}" download="datos_enfriamiento_simulacion.csv" class="inline-flex items-center bg-sky-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-sky-700 transition duration-300 shadow-lg">
                        <svg class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>
                        Descargar Datos (CSV)
                    </a>
                </div>
            `},
            { id: 'ejemplo', title: '6. Ejemplo Resuelto', content: `
                <h2 class="text-2xl sm:text-3xl font-extrabold text-sky-800 mb-6 border-b-2 border-amber-400 pb-2">Ejemplo: Termopar</h2>
                 <div class="bg-blue-50 p-4 sm:p-6 rounded-lg shadow-md mb-6">
                    <p class="font-bold text-lg text-blue-800 mb-3">Problema:</p>
                    <p class="text-gray-700">Un termopar esférico ($D=1.2\\text{mm}$) con $k=35\\text{W/mK}$, $\\rho=8500\\text{kg/m}^3$, $C_p=320\\text{J/kgK}$ y $h=90\\text{W/m}^2\\text{K}$ mide la temperatura de un gas. Calcule el tiempo para que el termopar registre el 99% del cambio de temperatura inicial.</p>
                </div>
                <h3 class="text-lg sm:text-xl font-semibold text-gray-700 mt-6 mb-3">Paso 1: Verificar Número de Biot (Bi)</h3>
                <ul class="list-disc list-inside text-gray-700 ml-4 mb-4 space-y-2">
                    <li>Longitud Característica: $L_c = D/6 = 0.0002 \\text{ m}$.</li>
                    <li>Cálculo de Bi:
                        <div class="math-block">$$\\text{Bi} = \\frac{h L_c}{k} = \\frac{(90)(0.0002)}{35} \\approx 0.000514$$</div>
                    </li>
                    <li><strong class="text-green-600">Conclusión:</strong> Como $\\text{Bi} \\le 0.1$, el modelo es <strong class="font-bold">válido</strong>.</li>
                </ul>
            `},
             { id: 'aplicaciones', title: '7. Aplicaciones', content: `
                <h2 class="text-2xl sm:text-3xl font-extrabold text-sky-800 mb-6 border-b-2 border-amber-400 pb-2">Aplicaciones Prácticas</h2>
                <div class="bg-sky-50 p-4 rounded-lg shadow-inner mb-6">
                   <img src='data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 300"%3E%3Crect width="800" height="300" fill="%23f0f9ff"/%3E%3Cg style="font-family: Inter, sans-serif; fill: %230c4a6e;" text-anchor="middle"%3E%3C!-- Termopar --%3E%3Crect x="100" y="100" width="200" height="120" rx="10" fill="%23e0f2fe" stroke="%237dd3fc" stroke-width="2"/%3E%3Ctext x="200" y="90" font-size="22" font-weight="bold"%3ETermopar%3C/text%3E%3Ccircle cx="200" cy="160" r="50" fill="none" stroke="%230ea5e9" stroke-width="3"/%3E%3Cpath d="M190,160 A10,10 0 0,1 210,160" stroke="%23f97316" stroke-width="4" fill="none"/%3E%3Cpath d="M200 110 L 200 50" stroke="%230284c7" stroke-width="2"/%3E%3Cpath d="M190 50 H 210" stroke="%230284c7" stroke-width="2"/%3E%3Ctext x="200" y="40" font-size="16"%3EFlujo de gas%3C/text%3E%3C!-- Chip Electronico --%3E%3Crect x="500" y="100" width="200" height="120" rx="10" fill="%23e0f2fe" stroke="%237dd3fc" stroke-width="2"/%3E%3Ctext x="600" y="90" font-size="22" font-weight="bold"%3EChip Electr%C3%B3nico%3C/text%3E%3Crect x="550" y="140" width="100" height="60" fill="%2338bdf8"/%3E%3Crect x="540" y="130" width="120" height="10" fill="%230ea5e9"/%3E%3Crect x="540" y="120" width="120" height="10" fill="%230ea5e9"/%3E%3Crect x="540" y="110" width="120" height="10" fill="%230ea5e9"/%3E%3Ctext x="600" y="175" fill="white" font-size="18" font-weight="bold"%3ESi%3C/text%3E%3C/g%3E%3C/svg%3E' alt="Imagen de Aplicaciones Industriales" class="w-full h-auto rounded-md">
                </div>
            `},
            { id: 'cuestionario', title: '8. Cuestionario', content: `
                <h2 class="text-2xl sm:text-3xl font-extrabold text-sky-800 mb-6 border-b-2 border-amber-400 pb-2">Cuestionario</h2>
                <div id="quiz-container" class="space-y-8"></div>
                <div id="quiz-results" class="mt-8 p-4 bg-sky-100 rounded-lg hidden">
                    <h3 class="text-xl font-bold text-sky-800">Resultados: <span id="score-display"></span></h3>
                </div>
            `},
            { id: 'ejercicios', title: '9. Ejercicios Finales', content: `
                <h2 class="text-2xl sm:text-3xl font-extrabold text-sky-800 mb-6 border-b-2 border-amber-400 pb-2">Ejercicios Propuestos</h2>
                <div class="bg-blue-50 p-6 rounded-lg shadow-md mb-6">
                    <p class="font-bold text-xl text-blue-800 mb-3">Ejercicio 1: Barra de Cobre</p>
                    <p class="text-gray-700">Una barra larga de cobre ($D=2.0\\text{cm}$) está a $T_i$. Se expone a aire a $T_{\\infty}$ con un coeficiente $h$. Calcule el tiempo para que se enfríe a $T(t)$.</p>
                </div>
            `},
            { id: 'bibliografia', title: '10. Bibliografía', content: `
                <h2 class="text-2xl sm:text-3xl font-extrabold text-sky-800 mb-6 border-b-2 border-amber-400 pb-2">Referencias</h2>
                <ol class="list-decimal list-inside text-gray-700 space-y-3 ml-4">
                    <li>Çengel, Y. A., & Ghajar, A. J. (<em class="font-semibold">Transferencia de calor y masa</em>). 4ª ed. McGraw-Hill, 2011.</li>
                    <li>Incropera, F. P., et al. (<em class="font-semibold">Fundamentals of Heat and Mass Transfer</em>). 7th Ed. Wiley, 2011.</li>
                </ol>
            `}
        ];
        const quizQuestions = [ { question: "El análisis de sistemas concentrados es válido si el Número de Biot (Bi) cumple con:", options: [ { text: "$$\\text{Bi} \\le 0.1$$", correct: true }, { text: "$$\\text{Bi} > 0.1$$", correct: false }, { text: "$$\\text{Bi} = 1$$", correct: false } ] }, { question: "¿Qué propiedad material favorece la aplicación del análisis?", options: [ { text: "Baja densidad ($\\rho$)", correct: false }, { text: "Alta conductividad térmica ($k$)", correct: true }, { text: "Bajo coeficiente de convección ($h$)", correct: false } ] }, { question: "¿Qué representa el parámetro '$b$' en la ecuación $e^{-b t}$?", options: [ { text: "El número de Biot.", correct: false }, { text: "La constante de tiempo del sistema.", correct: true }, { text: "El gradiente de temperatura.", correct: false } ] }, { question: "El análisis es válido cuando:", options: [ { text: "$R_{\\text{cond}} \\approx R_{\\text{conv}}$", correct: false }, { text: "$R_{\\text{cond}} \\gg R_{\\text{conv}}$", correct: false }, { text: "$R_{\\text{cond}} \\ll R_{\\text{conv}}$", correct: true } ] }, { question: "¿Cuál es la $L_c$ de una esfera de diámetro $D$?", options: [ { text: "$D/4$", correct: false }, { text: "$D/6$", correct: true }, { text: "$D/2$", correct: false } ] }];
        
        // --- Lógica para el menú responsive ---
        const sidebar = document.getElementById('sidebar');
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const closeMenuBtn = document.getElementById('close-menu-btn');
        const overlay = document.getElementById('mobile-menu-overlay');

        const openMenu = () => {
            sidebar.classList.remove('-translate-x-full');
            overlay.classList.remove('hidden');
        };

        const closeMenu = () => {
            sidebar.classList.add('-translate-x-full');
            overlay.classList.add('hidden');
        };

        mobileMenuBtn.addEventListener('click', openMenu);
        closeMenuBtn.addEventListener('click', closeMenu);
        overlay.addEventListener('click', closeMenu);


        // --- Lógica del módulo ---
        function shuffleArray(array) { for (let i = array.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [array[i], array[j]] = [array[j], array[i]]; } return array; }
        
        function renderContent(sectionId) {
            const content = moduleContent.find(s => s.id === sectionId);
            const contentArea = document.getElementById('module-content');
            const navItems = document.querySelectorAll('.accordion-item');
            if (content) {
                contentArea.innerHTML = content.content;
                navItems.forEach(item => {
                    item.classList.remove('active');
                    if (item.getAttribute('data-section-id') === sectionId) { item.classList.add('active'); }
                });
                if (sectionId === 'cuestionario') { renderQuiz(); }
                if (window.MathJax && window.MathJax.Hub) { MathJax.Hub.Queue(["Typeset", MathJax.Hub, contentArea]); }
                document.getElementById('content-area').scrollTop = 0;
                
                // Cerrar menú en móvil después de la selección
                if (window.innerWidth < 768) {
                    closeMenu();
                }
            }
        }
        function renderQuiz() {
            const quizContainer = document.getElementById('quiz-container');
            quizContainer.innerHTML = '';
            document.getElementById('quiz-results').classList.add('hidden');
            quizQuestions.forEach((q, qIndex) => {
                const shuffledOptions = shuffleArray([...q.options]);
                let questionHtml = `<div id="q-${qIndex}" class="question-block p-4 sm:p-6 border rounded-xl shadow-md bg-white"><p class="font-bold text-lg sm:text-xl text-sky-800 mb-4">P${qIndex + 1}. ${q.question}</p><div class="options-container space-y-3">`;
                shuffledOptions.forEach((option) => {
                    questionHtml += `<button data-is-correct="${option.correct}" onclick="checkAnswer(this)" class="w-full text-left p-3 border-2 border-sky-300 rounded-lg hover:bg-sky-100 transition duration-150 text-gray-700 font-medium bg-sky-50">${option.text}</button>`;
                });
                questionHtml += `</div><p id="feedback-${qIndex}" class="mt-3 font-semibold"></p></div>`;
                quizContainer.innerHTML += questionHtml;
            });
            if (window.MathJax && window.MathJax.Hub) { MathJax.Hub.Queue(["Typeset", MathJax.Hub, quizContainer]); }
        }
        function checkAnswer(selectedButton) {
            const isCorrect = selectedButton.getAttribute('data-is-correct') === 'true';
            const questionBlock = selectedButton.closest('.question-block');
            const qIndex = questionBlock.id.split('-')[1];
            const options = questionBlock.querySelectorAll('button');
            const feedback = document.getElementById(`feedback-${qIndex}`);
            options.forEach(btn => { btn.disabled = true; btn.classList.remove('hover:bg-sky-100'); });
            if (isCorrect) {
                selectedButton.classList.add('correct-answer');
                feedback.innerHTML = '<span class="text-green-600">¡Correcto!</span>';
            } else {
                selectedButton.classList.add('incorrect-answer');
                feedback.innerHTML = '<span class="text-red-600">Incorrecto.</span>';
                options.forEach(btn => { if (btn.getAttribute('data-is-correct') === 'true') { btn.classList.add('correct-answer', 'opacity-70'); } });
            }
            calculateScore();
        }
        function calculateScore() {
            const allQuestions = quizQuestions.length;
            let answeredCount = document.querySelectorAll('.question-block button:disabled').length;
             // Se divide por el número de opciones para obtener el número de preguntas respondidas
            const optionsPerQuestion = quizQuestions.length > 0 ? quizQuestions[0].options.length : 1;
            const answeredQuestions = Math.ceil(answeredCount / optionsPerQuestion);

            if (answeredQuestions === allQuestions) {
                let correctCount = document.querySelectorAll('.correct-answer:not(.opacity-70)').length;
                const scoreDisplay = document.getElementById('score-display');
                const quizResults = document.getElementById('quiz-results');
                scoreDisplay.textContent = `${correctCount} de ${allQuestions} (${((correctCount / allQuestions) * 100).toFixed(0)}%)`;
                quizResults.classList.remove('hidden');
            }
        }
        function initModule() {
            const accordionNav = document.getElementById('accordion-nav');
            moduleContent.forEach(section => {
                const navItem = document.createElement('div');
                navItem.className = 'accordion-item p-3 rounded-lg cursor-pointer transition duration-150 text-sky-50 hover:text-gray-900 font-semibold';
                navItem.setAttribute('data-section-id', section.id);
                navItem.textContent = section.title;
                navItem.onclick = () => renderContent(section.id);
                accordionNav.appendChild(navItem);
            });
            setTimeout(() => { renderContent('portada'); }, 100);
        }
        window.onload = initModule;
    </script>
</body>
</html>

